<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>final_project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="final_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="final_project_files/libs/quarto-html/quarto.js"></script>
<script src="final_project_files/libs/quarto-html/popper.min.js"></script>
<script src="final_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="final_project_files/libs/quarto-html/anchor.min.js"></script>
<link href="final_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="final_project_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="final_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="final_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="final_project_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<p><em>Shunkei Kakimoto</em></p>
<p><em>APEC 8601</em></p>
<section id="component-1" class="level2">
<h2 class="anchored" data-anchor-id="component-1">Component 1:</h2>
<ol type="a">
<li>Use SEALS to generate LULC maps for your country for 2030, 2035 and 2040. Do this for at least two different SSPs.`</li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<p>See the Github page <a href="https://shunkei3.github.io/final_assignment">here</a> for the details about how I run each InVEST model.</p>
<ol start="2" type="a">
<li>Plot these maps using QGIS or whatever plotting method you like.</li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<div id="cell-5" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="base" class="level2">
<h2 class="anchored" data-anchor-id="base">Base</h2>
<p><img style="float: center;" src="https://shunkei3.github.io/final_assignment/images/1b_out/out_base.png" width="800" height="500"></p>
</section>
<section id="ssp1-scenario" class="level2">
<h2 class="anchored" data-anchor-id="ssp1-scenario">SSP1 scenario</h2>
<p><img style="float: center;" src="https://shunkei3.github.io/final_assignment/images/1b_out/out_ssp1.png" width="1300" height="1000"></p>
</section>
<section id="ssp3-scenario" class="level2">
<h2 class="anchored" data-anchor-id="ssp3-scenario">SSP3 scenario</h2>
<p><img style="float: center;" src="https://shunkei3.github.io/final_assignment/images/1b_out/out_ssp3.png" width="1300" height="1000"></p>
<ol start="3" type="a">
<li>Add a new “policy” layer that prevents/encourages certain types of land-use change in certain areas. For instance, you could modify the calibration parameters file to decrease the likelihood that agricultural expansion happens on steep slopes.</li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<div id="cell-9" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Image_ssp1 <span class="op">=</span> cv2.imread(<span class="st">'../images/1c_out/out_ssp1.png'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Image_ssp3 <span class="op">=</span> cv2.imread(<span class="st">'../images/1c_out/out_ssp3.png'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Image_ssp1 <span class="op">=</span> cv2.cvtColor(Image_ssp1, cv2.COLOR_BGR2RGB)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>Image_ssp3 <span class="op">=</span> cv2.cvtColor(Image_ssp3, cv2.COLOR_BGR2RGB)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # === SSP1 === #</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">15</span>,<span class="dv">30</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plt.imshow(Image_ssp1)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # === SSP3 === #</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">15</span>,<span class="dv">30</span>))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>plt.imshow(Image_ssp3)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/cell-3-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_files/figure-html/cell-3-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="a">
<li>Write a narrative description of how the different scenarios differ in terms of what classes expand/contract and where.</li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<p>Looking at the base map, agricultural land is dominated in southern coastal regions. Under SSP1 scenario, which assumes the strong environmental conservation and comprehensive development to enhance people’s welfare happen, those coastal agricultural regions are servery shrunk, and natural forest are recovered.</p>
<p>SSP3 scenario assumes very opposite sociao-economic pathway. Specifically, it assumes that regional competitiveness over resources increases and peopel’s socioeconomic status decreases. Under this scenario, the forest areas decreases and progressive expansion of cropland can be seen around the urban areas located in the western region of the country.</p>
<p>In both scenarios, after modifying the calibration parameter so that the expansion of cropland is not allowed into forest, significant amount of cropland is reduced relative to the results before the modification. This is especially the case for SSP3 scenario.</p>
</section>
<section id="component-2" class="level2">
<h2 class="anchored" data-anchor-id="component-2">Component 2:</h2>
<ol type="a">
<li>Use the maps you generated to assess run ecosystem service assessments for each scenario. Specifically, run:</li>
</ol>
<ol type="a">
<li><p>Carbon Storage</p></li>
<li><p>Water Yield</p></li>
<li><p>Pollination</p></li>
<li><p>Sediment retention</p></li>
<li><p>Nutrient retention</p></li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<p>Here, I use the SEALS LULC data that I created in part (a) in component 1. Please see the Github page <a href="https://shunkei3.github.io/final_assignment">here</a> for the details about how I run each InVEST model. Below I show the maps produced by each InVEST model.</p>
</section>
<section id="a.-carbon-storage" class="level2">
<h2 class="anchored" data-anchor-id="a.-carbon-storage">a. Carbon Storage</h2>
<section id="ssp1-scenario-1" class="level3">
<h3 class="anchored" data-anchor-id="ssp1-scenario-1">SSP1 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/cs_ssp1_rcp26.png" width="1000" height="1000"></p>
</section>
<section id="ssp3-scenario-1" class="level3">
<h3 class="anchored" data-anchor-id="ssp3-scenario-1">SSP3 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/cs_ssp3_rcp70.png" width="1000" height="1000"></p>
</section>
</section>
<section id="b.-water-yield" class="level2">
<h2 class="anchored" data-anchor-id="b.-water-yield">b. Water Yield</h2>
<section id="ssp1-scenario-2" class="level3">
<h3 class="anchored" data-anchor-id="ssp1-scenario-2">SSP1 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/wy_ssp1_rcp26.png" width="1000" height="1000"></p>
</section>
<section id="ssp3-scenario-2" class="level3">
<h3 class="anchored" data-anchor-id="ssp3-scenario-2">SSP3 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/wy_ssp3_rcp70.png" width="1000" height="1000"></p>
</section>
</section>
<section id="c.-pollination" class="level2">
<h2 class="anchored" data-anchor-id="c.-pollination">c.&nbsp;Pollination</h2>
<section id="ssp1-scenario-3" class="level3">
<h3 class="anchored" data-anchor-id="ssp1-scenario-3">SSP1 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/cp_ssp1_rcp26.png" width="1000" height="1000"></p>
</section>
<section id="ssp3-scenario-3" class="level3">
<h3 class="anchored" data-anchor-id="ssp3-scenario-3">SSP3 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/cp_ssp3_rcp70.png" width="1000" height="1000"></p>
</section>
</section>
<section id="d.-sediment-retention" class="level2">
<h2 class="anchored" data-anchor-id="d.-sediment-retention">d.&nbsp;Sediment retention</h2>
<section id="ssp1-scenario-4" class="level3">
<h3 class="anchored" data-anchor-id="ssp1-scenario-4">SSP1 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/sdr_ssp1_rcp26.png" width="800" height="1200"></p>
</section>
<section id="ssp3-scenario-4" class="level3">
<h3 class="anchored" data-anchor-id="ssp3-scenario-4">SSP3 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/sdr_ssp3_rcp70.png" width="800" height="1200"></p>
</section>
</section>
<section id="e.-nutrient-retention" class="level2">
<h2 class="anchored" data-anchor-id="e.-nutrient-retention">e. Nutrient retention</h2>
<section id="ssp1-scenario-5" class="level3">
<h3 class="anchored" data-anchor-id="ssp1-scenario-5">SSP1 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/ndr_ssp1_rcp26.png" width="1000" height="1000"></p>
</section>
<section id="ssp3-scenario-5" class="level3">
<h3 class="anchored" data-anchor-id="ssp3-scenario-5">SSP3 scenario</h3>
<p><img src="https://shunkei3.github.io/final_assignment/images/slv_InVEST_out/ndr_ssp3_rcp70.png" width="1000" height="1000"></p>
<ol start="3" type="a">
<li>Write a narrative description of how the different scenarios differ in terms of which ecosystem services see localized increases/decreases</li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<p>Although large difference in all ecosystem services (carbon storage, water yield, crop pollination, sediment retention, and nutrient retention) can be seen between SSP1 and SSP3 scenarios, there is not much difference across years (The quantity of each ecosystem service looks the same across in the figures, but they are slightly different.)</p>
<p>Compared to SSP1 scenario, which value the value of nature, large reduction of ecosystem services can be confirmed especially in the regions where cropland is expanding.</p>
<ol start="4" type="a">
<li>Write a 1 paragraph executive summary on your results from the perspective of what a policy maker interested in “green economic development” should know about their country’s ecosystem services.</li>
</ol>
<p><font color="red"><strong>Answer:</strong></font></p>
<p>In the case of El Salvador, a significant change in ecosystem services cannot be confirmed during the period 2030-2040 in each SSP scenario. One reason for this is that the time period (10 years) I used in this analysis was too short to see a significant land-use change. This implies that a policymaker should not expect a policy to affect their ecosystem services instantly; rather, it takes a long time to see results. Another reason why I could not see any changes in ecosystem services in El Salvador might be that the assumed policy in this analysis is linked to ecosystem services. Given the distinct socio-economic conditions by country, a policymaker should not expect that a policy that positively impacted ecosystem services in another nation has a similar effect on their country. A deep understanding of their county’s unique mechanism of ecosystem services is required to achieve green economic development.</p>
<p>Through this project, I was given an overview of how to use the SEALS and InVEST models. Due to the limitation of time, I could not explore the impact on several different policies on ecosystem services. I would like to pursue this further during this summer break.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>